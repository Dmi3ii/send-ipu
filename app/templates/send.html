{% extends "layout.html" %}

{% block title %}Отправить показания{% endblock %}

{% block body %}
<div class="container">
    <main>
        <form id="form" name="form" class="needs-validation" novalidate="" method="post">
            <div class="row g-5">
                <div class="col-md-5 col-lg-4 order-md-last">
                    <h4 class="d-flex justify-content-between align-items-center mb-3">
                        <span class="display-6 text-primary">Показания ИПУ</span>
                    </h4>
                    <ul class="list-group mb-3">
                        <li class="list-group-item d-flex justify-content-between lh-sm">
                            <div>
                                <h6 class="my-0">ГВС</h6>
                                <small class="text-muted">Горячее водоснабжение</small>
                            </div>
                            <input type="text" class="form-control pe-1 ps-1 text-center w-25" id="GVS" name="GVS" placeholder="" value="" required="">
                        </li>
                        <li class="list-group-item d-flex justify-content-between lh-sm">
                            <div>
                                <h6 class="my-0">ХВС</h6>
                                <small class="text-muted">Холодное водоснабжение</small>
                            </div>
                            <input type="text" class="form-control pe-1 ps-1 text-center w-25" id="HVS" name="HVS" placeholder="" value="" required="">
                        </li>
                        <li class="list-group-item d-flex justify-content-between lh-sm">
                            <div>
                                <h6 class="my-0">ГАЗ</h6>
                                <small class="text-muted">Газоснабжение</small>
                            </div>
                            <input type="text" class="form-control pe-1 ps-1 text-center w-25" id="GAZ" name="GAZ" placeholder="" value="" required="">
                        </li>
                        <li class="list-group-item d-flex justify-content-between lh-sm">
                            <div>
                                <h6 class="my-0">ЭЛ</h6>
                                <small class="text-muted">Электроснабжение</small>
                            </div>
                            <input type="text" class="form-control pe-1 ps-1 text-center w-25" id="EL" name="EL" placeholder="" value="" required="">
                        </li>
                    </ul>
                    <h4 class="d-flex justify-content-between align-items-center mb-3">
                        <span class="display-6 text-primary">Настройка рассылки</span>
                    </h4>
                    <p class="lead">отправлять в:</p>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="send_sk_at_erc51_ru" checked name="send_sk_at_erc51_ru">
                        <label class="form-check-label text-secondary" for="send_sk_at_erc51_ru">Мурманводоканал (<mail login="sk" server="erc51.ru"></mail>) ГВС, ХВС</label>
                    </div>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="send_oookola_v_centr_at_mail_ru" checked name="send_oookola_v_centr_at_mail_ru">
                        <label class="form-check-label text-secondary" for="send_oookola_v_centr_at_mail_ru">ООО "КВЦ" (<mail login="oookola_v_centr" server="mail.ru"></mail>) ГАЗ, ЭЛ</label>
                    </div>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="send_ooo_megaplast_at_mail_ru" checked name="send_ooo_megaplast_at_mail_ru">
                        <label class="form-check-label text-secondary" for="send_ooo_megaplast_at_mail_ru">Мурмашинский расчётный центр (<mail login="ooo-megaplast" server="mail.ru"></mail>) ГВС</label>
                    </div>
                </div>

                <div class="col-md-7 col-lg-8">
                    <h4 class="display-6 text-primary">Ваши данные</h4>
                    <p class="lead">Ваши данные будут вставлены в письма рассылки компаниям предоставляющим услуги.
                        На ваш электронный адрес должны прийти ответные письма о приеме показаний.</p>
                    <div class="row g-3">
                        <div class="col-sm-6">
                            <label for="fio" class="form-label">Фамилия Имя Отчество</label>
                            <input type="text" class="form-control" id="fio" name="fio" placeholder="" value="" required="">
                            <div class="invalid-feedback">
                                Valid first name is required.
                            </div>
                        </div>

                        <div class="col-sm-6">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="email" name="email" placeholder="you@example.com"
                                required="">
                            <div class="invalid-feedback">
                                Please enter a valid email address for shipping updates.
                            </div>
                        </div>

                        <div class="col-12">
                            <label for="address" class="form-label">Адрес</label>
                            <input type="text" class="form-control" id="address" name="address"
                                placeholder="пгт. Мурмаши, Советская д.88, кв.8" required="">
                            <div class="invalid-feedback">
                                Please enter your shipping address.
                            </div>
                        </div>

                        <h5 class="align-items-center d-flex justify-content-between mb-2 mt-4">
                            <span class="display-6 text-primary">Мурманводоканал (<mail login="sk" server="erc51.ru"></mail>)</span>
                        </h5>
                        <p class="lead">В Мурманводоканал отсылаются данный ГВС и ХВС. Идентификатор счетчика ищите в квитанции.</p>
                        <div class="col-sm-6 mt-0">
                            <label for="id_IPU_HVS" class="form-label">Идентификатор счетчика холодной воды</label>
                            <input type="text" class="form-control" id="id_IPU_HVS" name="id_IPU_HVS" placeholder="" value="" required="">
                            <div class="invalid-feedback">
                                Valid last name is required.
                            </div>
                        </div>

                        <div class="col-sm-6 mt-0">
                            <label for="id_IPU_GVS" class="form-label">Идентификатор счетчика горячей воды</label>
                            <input type="text" class="form-control" id="id_IPU_GVS" name="id_IPU_GVS" placeholder="" value="" required="">
                            <div class="invalid-feedback">
                                Valid last name is required.
                            </div>
                        </div>

                        <h5 class="align-items-center d-flex justify-content-between mb-2 mt-4">
                            <span class="display-6 text-primary">Мурманоблгаз и Атомэнергосбыт (ООО "КВЦ" <mail login="oookola_v_centr" server="mail.ru"></mail>)</span>
                        </h5>
                        <p class="lead">Данные по газу и электроэнергии передаются в ООО "КВЦ". Если вы не передаете эти данные оставьте поля ГАЗ или ЭЛ пустыми.</p>

                        <div class="col-sm-6 mt-0">
                            <label for="lsGAZ" class="form-label">ЛС Мурманоблгаз</label>
                            <input type="text" class="form-control" id="lsGAZ" name="lsGAZ" placeholder="" value="">
                        </div>

                        <div class="col-sm-6 mt-0">
                            <label for="lsEL" class="form-label">ЛС Атомэнергосбыт</label>
                            <input type="text" class="form-control" id="lsEL" name="lsEL" placeholder="" value="">
                        </div>

                        <h5 class="align-items-center d-flex justify-content-between mb-2 mt-4">
                            <span class="display-6 text-primary">Мурмашинский расчётный центр (<mail login="ooo-megaplast" server="mail.ru"></mail>)</span>
                        </h5>
                        <p class="lead">Мурмашинский расчётный центр принимает показание по ГВС.</p>

                        <div class="col mt-0 mb-5">
                            <label for="lsGVS" class="form-label">ЛС</label>
                            <input type="text" class="form-control" id="lsGVS" name="lsGVS" placeholder="" value="">
                        </div>

                        <div class="col-12">
                            <button class="w-100 btn btn-primary btn-lg" onclick="saveAndSend(event)">Отправить показания</button>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </main>
</div>

<script>
    window.onload = function() {
        setEmail()
        getData()
    };

    function setEmail() {
        emails = document.getElementsByTagName("mail")
        for (email of emails) {
            login = email.getAttribute("login")
            server = email.getAttribute("server")
            email.textContent = login + "@" + server
        }
    }

    function setData() {
        let el = document.getElementsByTagName("input");
        for (var i=0; i < el.length; i++) {
            localStorage.setItem(el[i].name, el[i].value);
            // console.log(el[i].name + ":" + el[i].value);
        }
    }

    function getData() {
        let keys = Object.keys(localStorage);
        for(let key of keys) {
            value = localStorage.getItem(key);
            document.getElementById(key).value = value;
            // console.log(`${key}: ${value}`);
        }
    }

    function saveAndSend(e) {
        setData();
        e.preventDefault();
        //debugger
        document.getElementById("form").submit()
    }
</script>

<!-- <div id="wot-nidnamewot-new-assistant-container">
    <div data-reactroot=""></div>
</div> -->

{% endblock %}